<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unitage Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="bg-stone-50 font-sans text-stone-900">

    <!-- Login Screen -->
    <div id="login-screen" class="flex h-screen items-center justify-center bg-stone-100">
        <form onsubmit="event.preventDefault(); login()" class="bg-white p-8 rounded-xl shadow-xl w-96 border border-stone-200">
            <div class="flex justify-center mb-6">
                <span class="w-12 h-12 bg-red-900 text-white flex items-center justify-center rounded text-xl font-serif font-bold">U</span>
            </div>
            <h2 class="text-2xl font-bold mb-6 text-center text-stone-800">–í—Ö–æ–¥ –≤ Unitage OS</h2>
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full p-3 border border-stone-300 rounded mb-4 focus:outline-none focus:border-red-800 transition shadow-sm" autofocus>
            <button type="submit" class="w-full bg-stone-900 text-white py-3 rounded font-semibold hover:bg-black transition transform active:scale-95">–í–æ–π—Ç–∏</button>
            <p class="mt-4 text-xs text-center text-stone-400">–ü–∞—Ä–æ–ª—å: admin123</p>
        </form>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="hidden min-h-screen flex">
        
        <!-- Sidebar -->
        <aside class="w-64 bg-stone-900 text-stone-300 fixed h-full flex flex-col z-20 shadow-2xl">
            <div class="p-6 text-white font-bold text-xl border-b border-stone-800 flex items-center gap-3">
                <span class="bg-red-800 text-white w-8 h-8 flex items-center justify-center rounded-md text-sm font-serif">U</span>
                Unitage
            </div>
            <nav class="flex-1 p-4 space-y-2 mt-4">
                <button onclick="showTab('create')" id="nav-create" class="w-full text-left px-4 py-3 bg-stone-800 text-white rounded-lg hover:bg-stone-700 transition flex items-center gap-3">
                    <span>üìù</span> –ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è
                </button>
                <button onclick="showTab('list')" id="nav-list" class="w-full text-left px-4 py-3 hover:bg-stone-800 rounded-lg transition flex items-center gap-3 text-stone-400 hover:text-white">
                    <span>üìö</span> –í—Å–µ —Å—Ç–∞—Ç—å–∏
                </button>
                
                <div class="pt-8 mt-8 border-t border-stone-800">
                    <a href="/" target="_blank" class="block px-4 py-2 hover:bg-stone-800 rounded-lg transition flex items-center gap-3 text-stone-500 hover:text-white text-sm">
                        <span>‚ÜóÔ∏è</span> –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç
                    </a>
                </div>
            </nav>
            <div class="p-4 border-t border-stone-800 text-xs text-stone-600 text-center">
                Unitage v2.1 Stable<br>JSON Edition
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="ml-64 p-12 w-full bg-stone-50 min-h-screen">
            
            <!-- TAB: CREATE ARTICLE -->
            <div id="tab-create" class="max-w-5xl mx-auto animate-fade-in">
                <header class="flex justify-between items-center mb-8">
                    <div>
                        <h1 class="text-3xl font-bold text-stone-900">–†–µ–¥–∞–∫—Ç–æ—Ä</h1>
                        <p class="text-stone-500 text-sm mt-1">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª</p>
                    </div>
                    <button onclick="openJsonModal()" class="flex items-center gap-2 px-4 py-2 bg-white border border-stone-300 text-stone-700 rounded-lg hover:bg-stone-50 hover:border-stone-400 transition shadow-sm text-sm font-medium">
                        <span>üì•</span> –ò–º–ø–æ—Ä—Ç –∏–∑ ChatGPT
                    </button>
                </header>

                <form id="article-form" class="space-y-6 bg-white p-8 rounded-2xl shadow-sm border border-stone-200">
                    <!-- Title & Slug -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs font-bold uppercase text-stone-500 mb-2">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                            <input type="text" id="title" class="w-full p-3 border border-stone-200 rounded-lg bg-stone-50 focus:bg-white focus:border-stone-400 transition outline-none font-serif text-lg" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–∞–¥–µ–Ω–∏–µ –†–∏–º–∞">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-stone-500 mb-2">Slug (URL)</label>
                            <input type="text" id="slug" class="w-full p-3 border border-stone-200 rounded-lg bg-stone-50 font-mono text-sm text-stone-600 outline-none" placeholder="fall-of-rome">
                        </div>
                    </div>

                    <!-- Category & Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-xs font-bold uppercase text-stone-500 mb-2">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="category" class="w-full p-3 border border-stone-200 rounded-lg bg-stone-50 outline-none cursor-pointer">
                                <option>–ê–Ω—Ç–∏—á–Ω–æ—Å—Ç—å</option>
                                <option>–°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ</option>
                                <option>–ù–æ–≤–æ–µ –≤—Ä–µ–º—è</option>
                                <option>XX –í–µ–∫</option>
                                <option>–î—Ä–µ–≤–Ω–∏–π –º–∏—Ä</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-xs font-bold uppercase text-stone-500 mb-2">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (Preview)</label>
                            <textarea id="summary" rows="1" class="w-full p-3 border border-stone-200 rounded-lg bg-stone-50 outline-none resize-none" placeholder="–ò–Ω—Ç—Ä–∏–≥—É—é—â–∏–π –ª–∏–¥..."></textarea>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div>
                        <label class="block text-xs font-bold uppercase text-stone-500 mb-2">–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç (HTML)</label>
                        <textarea id="content" rows="12" class="w-full p-4 border border-stone-200 rounded-lg font-mono text-sm leading-relaxed outline-none text-stone-700 bg-stone-50 focus:bg-white transition" placeholder="<p>–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏...</p>"></textarea>
                    </div>

                    <!-- Perspectives (Unitage Feature) -->
                    <div class="border-t border-stone-100 pt-8 mt-8">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-bold flex items-center gap-2">
                                <span class="w-6 h-6 bg-stone-200 rounded flex items-center justify-center text-xs">üíé</span>
                                –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã (–ê–Ω–∞–ª–∏–∑)
                            </h3>
                            <button type="button" onclick="addPerspective()" class="text-xs bg-stone-100 hover:bg-stone-200 text-stone-700 px-3 py-1.5 rounded-md font-medium transition">+ –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</button>
                        </div>
                        
                        <div id="perspectives-container" class="space-y-4">
                            <!-- Dynamic blocks go here -->
                        </div>
                    </div>

                    <!-- Action Bar -->
                    <div class="flex items-center justify-between pt-8 border-t border-stone-100">
                        <div class="text-xs text-stone-400 max-w-md">
                            * –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Å–ø—Ä–∞–≤–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å JSON-–∫–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –ø—Ä–æ–µ–∫—Ç.
                        </div>
                        <button type="button" onclick="copyJSON()" class="flex items-center gap-2 px-6 py-3 bg-green-700 text-white font-bold rounded-lg hover:bg-green-800 transition shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                            <span>üìã</span> –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON-–∫–æ–¥
                        </button>
                    </div>
                </form>
            </div>

            <!-- TAB: LIST ARTICLES -->
            <div id="tab-list" class="hidden max-w-5xl mx-auto">
                <header class="mb-8">
                    <h1 class="text-3xl font-bold text-stone-900">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</h1>
                    <p class="text-stone-500 text-sm mt-1">–í—Å–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</p>
                </header>
                
                <div class="bg-white rounded-2xl shadow-sm border border-stone-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-stone-50 border-b border-stone-200 text-stone-500 uppercase font-bold text-xs">
                                <tr>
                                    <th class="px-6 py-4">–ó–∞–≥–æ–ª–æ–≤–æ–∫</th>
                                    <th class="px-6 py-4">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                    <th class="px-6 py-4">Slug</th>
                                    <th class="px-6 py-4 text-right">–î–µ–π—Å—Ç–≤–∏–µ</th>
                                </tr>
                            </thead>
                            <tbody id="articles-list-body" class="divide-y divide-stone-100">
                                <!-- List injected by JS -->
                                <tr>
                                    <td colspan="4" class="px-6 py-8 text-center text-stone-400">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="mt-4 text-center text-xs text-stone-400">
                    * –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–∞—Ç–µ–π –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∫—É –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ JSON.
                </div>
            </div>

        </main>
    </div>

    <!-- JSON Import Modal -->
    <div id="json-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center z-50 animate-fade-in">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-[600px] max-w-full border border-stone-200 m-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">–ò–º–ø–æ—Ä—Ç –∏–∑ AI</h3>
                <button onclick="closeJsonModal()" class="text-stone-400 hover:text-stone-600 text-xl">&times;</button>
            </div>
            <p class="text-xs text-stone-500 mb-3 bg-stone-50 p-2 rounded border border-stone-100">
                –í—Å—Ç–∞–≤—å—Ç–µ JSON, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ChatGPT/Claude. –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç –≤—Å—ë –ø–æ –ø–æ–ª—è–º.
            </p>
            <textarea id="json-input" rows="10" class="w-full p-4 border border-stone-300 rounded-lg font-mono text-xs mb-6 bg-stone-50 outline-none focus:border-stone-500 transition" placeholder='{ "title": "...", "content": "..." }'></textarea>
            <div class="flex justify-end gap-3">
                <button onclick="closeJsonModal()" class="px-4 py-2 text-stone-600 hover:bg-stone-100 rounded-lg text-sm font-medium transition">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="applyJson()" class="px-6 py-2 bg-stone-900 text-white rounded-lg hover:bg-black text-sm font-bold transition shadow-md">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            </div>
        </div>
    </div>

    <script>
        // --- AUTH LOGIC ---
        function login() {
            const pass = document.getElementById('password').value;
            if (pass === 'admin123') {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                loadArticlesList(); // Load data immediately
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
            }
        }

        // --- TABS LOGIC ---
        function showTab(tabName) {
            // Update Content
            document.getElementById('tab-create').classList.add('hidden');
            document.getElementById('tab-list').classList.add('hidden');
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');

            // Update Sidebar UI
            const btnCreate = document.getElementById('nav-create');
            const btnList = document.getElementById('nav-list');
            
            if (tabName === 'create') {
                btnCreate.className = "w-full text-left px-4 py-3 bg-stone-800 text-white rounded-lg hover:bg-stone-700 transition flex items-center gap-3";
                btnList.className = "w-full text-left px-4 py-3 hover:bg-stone-800 rounded-lg transition flex items-center gap-3 text-stone-400 hover:text-white";
            } else {
                btnCreate.className = "w-full text-left px-4 py-3 hover:bg-stone-800 rounded-lg transition flex items-center gap-3 text-stone-400 hover:text-white";
                btnList.className = "w-full text-left px-4 py-3 bg-stone-800 text-white rounded-lg hover:bg-stone-700 transition flex items-center gap-3";
                loadArticlesList();
            }
        }

        // --- ARTICLES LIST LOGIC ---
        async function loadArticlesList() {
            const tbody = document.getElementById('articles-list-body');
            try {
                const res = await fetch('/api/articles');
                const articles = await res.json();
                
                if (!articles || articles.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-stone-400">–ù–µ—Ç —Å—Ç–∞—Ç–µ–π</td></tr>';
                    return;
                }

                tbody.innerHTML = articles.map(a => `
                    <tr class="hover:bg-stone-50 transition cursor-default">
                        <td class="px-6 py-4 font-medium text-stone-900">${a.title}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 bg-stone-100 text-stone-600 text-xs rounded-md border border-stone-200">${a.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'}</span>
                        </td>
                        <td class="px-6 py-4 font-mono text-xs text-stone-500">${a.slug}</td>
                        <td class="px-6 py-4 text-right">
                            <a href="/article.html?slug=${a.slug}" target="_blank" class="text-primary hover:underline text-xs font-bold">–ü—Ä–æ—Å–º–æ—Ç—Ä ‚Üó</a>
                        </td>
                    </tr>
                `).join('');

            } catch (e) {
                tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-red-400">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞</td></tr>';
            }
        }

        // --- EDITOR LOGIC ---
        function openJsonModal() { document.getElementById('json-modal').classList.remove('hidden'); }
        function closeJsonModal() { document.getElementById('json-modal').classList.add('hidden'); }
        
        function applyJson() {
            try {
                const raw = document.getElementById('json-input').value;
                const data = JSON.parse(raw);
                
                if(data.title) document.getElementById('title').value = data.title;
                if(data.slug) document.getElementById('slug').value = data.slug;
                if(data.category) document.getElementById('category').value = data.category;
                if(data.summary) document.getElementById('summary').value = data.summary;
                if(data.content) document.getElementById('content').value = data.content;

                if(data.perspectives && Array.isArray(data.perspectives)) {
                    const container = document.getElementById('perspectives-container');
                    container.innerHTML = '';
                    data.perspectives.forEach(p => {
                        addPerspective();
                        const block = container.lastElementChild;
                        const inputs = block.querySelectorAll('input');
                        const textarea = block.querySelector('textarea');
                        inputs[0].value = p.type || 'context';
                        inputs[1].value = p.title || '';
                        textarea.value = p.content || '';
                    });
                }
                closeJsonModal();
            } catch (e) {
                alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON: ' + e.message);
            }
        }

        function addPerspective() {
            const container = document.getElementById('perspectives-container');
            const div = document.createElement('div');
            div.className = 'bg-stone-50 p-4 rounded-lg border border-stone-200 relative animate-fade-in';
            div.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
                    <div class="md:col-span-1">
                        <input type="text" placeholder="–¢–∏–ø (economic, cultural...)" class="w-full p-2 border border-stone-200 rounded text-xs bg-white font-mono">
                    </div>
                    <div class="md:col-span-2">
                        <input type="text" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –±–ª–æ–∫–∞ (–Ω–∞–ø—Ä. –¶–µ–Ω–∞ –≤–æ–π–Ω—ã)" class="w-full p-2 border border-stone-200 rounded text-xs bg-white font-bold">
                    </div>
                </div>
                <textarea rows="3" class="w-full p-3 border border-stone-200 rounded text-xs leading-relaxed bg-white" placeholder="–¢–µ–∫—Å—Ç –∞–Ω–∞–ª–∏–∑–∞..."></textarea>
                <button type="button" onclick="this.parentElement.remove()" class="absolute top-2 right-2 w-6 h-6 flex items-center justify-center text-stone-400 hover:text-red-600 hover:bg-red-50 rounded-full transition">&times;</button>
            `;
            container.appendChild(div);
        }

        function copyJSON() {
             const formData = {
                id: Date.now(),
                title: document.getElementById('title').value,
                slug: document.getElementById('slug').value,
                category: document.getElementById('category').value,
                published_at: new Date().toISOString(),
                hero_image_url: "", // Optional
                summary: document.getElementById('summary').value,
                content: document.getElementById('content').value,
                perspectives: []
            };

            const container = document.getElementById('perspectives-container');
            container.childNodes.forEach(node => {
                if(node.tagName === 'DIV') {
                    const inputs = node.querySelectorAll('input');
                    const textarea = node.querySelector('textarea');
                    formData.perspectives.push({
                        type: inputs[0].value,
                        title: inputs[1].value,
                        content: textarea.value
                    });
                }
            });

            const jsonString = JSON.stringify(formData, null, 2);
            navigator.clipboard.writeText(jsonString).then(() => {
                alert('‚úÖ JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!\n\n1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª src/articles.json\n2. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–ø—è—Ç—É—é –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç–∞—Ç—å–∏\n3. –í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫\n4. –°–¥–µ–ª–∞–π—Ç–µ Commit');
            });
        }
    </script>

    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</body>
</html>
